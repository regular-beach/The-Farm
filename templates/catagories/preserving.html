<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preserving Food</title>
    <link href="{{ url_for('static', filename='styles/base.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='styles/catagories/preserving.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='styles/catagories/catagory.css') }}" rel="stylesheet" />
</head>


<body>
     <!--<div id="loading-screen">
        <p id="loading-text">Loading</p>
    </div>
    <div id="main-content" style="display:none;"> --> 
    {% include 'navigation.html' %}

    <div class="hero-container">
    <div class="pagetitle">Preserving Food</div>
    <img class="hero" src="{{ url_for('static', filename='/img/hero/HERO2.jpg') }}" alt="Preserving Food Image">
</div>

<div class="grid">
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/01.jpg') }}">
    </div>

    <div class="grid-item">
        <video autoplay loop muted playsinline>
            <source data-src="{{ url_for('static', filename='/img/preserving/preserving.mp4') }}" type="video/mp4">
        </video>
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_0437.jpg') }}">
    </div>
 
    <div class="grid-item">
        <video autoplay loop muted playsinline>
            <source data-src="{{ url_for('static', filename='/img/preserving/walnutdye.webm') }}" type="video/webm">
            <source data-src="{{ url_for('static', filename='/img/preserving/walnutdye.mp4') }}" type="video/mp4">
        </video>
    </div>
    <div class="grid-item">
        <video autoplay loop muted playsinline>
            <source data-src="{{ url_for('static', filename='/img/preserving/sauce.webm') }}" type="video/webm">
            <source data-src="{{ url_for('static', filename='/img/preserving/sauce.mp4') }}" type="video/mp4">
        </video>
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_4144.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_5115.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_6457.jpg') }}">
    </div>

    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_6645.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_6931.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/03.jpg') }}">
    </div>
 
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_6997.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_7085.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_7375.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_7472.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_7864.jpg') }}">
    </div>
    <div class="grid-item">
        <video autoplay loop muted playsinline>
            <source data-src="{{ url_for('static', filename='/img/preserving/cider2.webm') }}" type="video/webm">
            <source data-src="{{ url_for('static', filename='/img/preserving/cider2.mp4') }}" type="video/mp4">
        </video>
    </div>
    <div class="grid-item">
        <video autoplay loop muted playsinline>
            <source data-src="{{ url_for('static', filename='/img/preserving/preserving2.mp4') }}" type="video/mp4">
        </video>
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/HERO1.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_8216.jpg') }}">
    </div>

 
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_8270.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_8291.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_8300.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_8681.jpg') }}">
    </div>
    <div class="grid-item">
        <video autoplay loop muted playsinline>
            <source data-src="{{ url_for('static', filename='/img/preserving/pulp.mp4') }}" type="video/mp4">
        </video>
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_0507.jpg') }}">
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_8716.jpg') }}">
    </div>
    <div class="grid-item">
        <video autoplay loop muted playsinline>
            <source data-src="{{ url_for('static', filename='/img/preserving/labels4.webm') }}" type="video/webm">
            <source data-src="{{ url_for('static', filename='/img/preserving/labels4.mp4') }}" type="video/mp4">
        </video>
    </div>
    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/IMG_9268.jpg') }}">
    </div>

    <div class="grid-item">
        <img data-src="{{ url_for('static', filename='/img/preserving/02.jpg') }}">
    </div>
    <div class="grid-item">
        <video autoplay loop muted playsinline>
            <source data-src="{{ url_for('static', filename='/img/preserving/cider3.mp4') }}" type="video/mp4">
        </video>
    </div>


</div>


{% include 'footerpreserve.html' %}
</div>

<script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
<script src="https://unpkg.com/packery@2.1.2/dist/packery.pkgd.min.js"></script>
<script>
//for loading
//window.addEventListener('load', () => {
    // Hide the loading screen
    //const loadingScreen = document.getElementById('loading-screen');
    //const mainContent = document.getElementById('main-content');

    //loadingScreen.style.display = 'none'; // Hide the loading screen
   // mainContent.style.display = 'block'; // Show the main content
//});

window.onload = () => {
    const grid = document.querySelector('.grid');
    if (!grid) return;

    const pckry = new Packery(grid, {
        itemSelector: '.grid-item',
        percentPosition: true
    });

    // Load all images/videos before initializing Packery
    imagesLoaded(grid, function () {
        pckry.layout();
    });

    // Lazy loading logic with Packery relayout on load
    const lazyImages = document.querySelectorAll('.grid-item img');
    const lazyVideos = document.querySelectorAll('.grid-item video');

    const lazyLoad = (entries, observer) => {
        entries.forEach(entry => {
            const target = entry.target;

            if (entry.isIntersecting) {
                if (target.tagName === 'IMG') {
                    const src = target.dataset.src;
                    if (src) {
                        target.src = src;
                        target.onload = () => {
                            target.classList.add('loaded');
                            observer.unobserve(target);
                            pckry.layout(); // ← Trigger re-layout here
                        };
                    }
                } else if (target.tagName === 'VIDEO') {
                    const sources = target.querySelectorAll('source');
                    sources.forEach(source => {
                        source.src = source.dataset.src;
                    });
                    target.load();
                    target.oncanplaythrough = () => {
                        target.classList.add('loaded');
                        observer.unobserve(target);
                        pckry.layout(); // ← Trigger re-layout here too
                        const pckry = new Packery(grid, {
  itemSelector: '.grid-item',
  percentPosition: true
});

const layoutPackery = () => pckry.layout(); // helper to clean up syntax

// Inside your lazyLoad function (where you handle image load):
img.onload = () => {
  img.classList.add('loaded');
  observer.unobserve(img);
  layoutPackery(); // 👈 force re-layout after each image load
};

                    };
                }
            }
        });
    };

    const observer = new IntersectionObserver(lazyLoad, {
        rootMargin: '0px 0px 200px 0px'
    });

    lazyImages.forEach(img => observer.observe(img));
    lazyVideos.forEach(video => observer.observe(video));

};

</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vineyard</title>
    <link href="{{ url_for('static', filename='styles/base.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='styles/catagories/catagory.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='styles/catagories/vineyard.css') }}" rel="stylesheet" />
   

</head>


<body>
    <!--<div id="loading-screen">
        <p id="loading-text">Loading</p>
    </div>
    <div id="main-content" style="display:none;"> --> 

    {% include 'navigation.html' %}


<div class="gridtitle">
    <div class="pagetitle">Vineyard</div>
</div>
<img class="hero" src="{{ url_for('static', filename='/img/vineyard/vineyard.jpg') }}" alt="History Image">

    <div class="grid">
        <div class="grid-item">
            <video autoplay loop muted playsinline>
                <source data-src="{{ url_for('static', filename='/img/vineyard/tractor.mp4') }}" type="video/mp4">
            </video>
        </div>  
        <div class="grid-item">
            <img data-src="{{ url_for('static', filename='/img/vineyard/IMG_4189.jpg') }}">
        </div> 
        <div class="grid-item">
            <video autoplay loop muted playsinline>
                <source data-src="{{ url_for('static', filename='/img/vineyard/bees.webm') }}" type="video/webm">
                <source data-src="{{ url_for('static', filename='/img/vineyard/bees.mp4') }}" type="video/mp4">
            </video>
        </div>  
        <div class="grid-item">
            <video autoplay loop muted playsinline>
                <source data-src="{{ url_for('static', filename='/img/vineyard/compost.mp4') }}" type="video/mp4">
            </video>
            </div>
            <div class="grid-item">
                <video autoplay loop muted playsinline>
                    <source data-src="{{ url_for('static', filename='/img/vineyard/grapes.mp4') }}" type="video/mp4">
                </video>
            </div>  
     
        <div class="grid-item">
            <img data-src="{{ url_for('static', filename='/img/vineyard/IMG_0275.jpg') }}">
        </div>
        <div class="grid-item">
            <video autoplay loop muted playsinline>
                <source data-src="{{ url_for('static', filename='/img/vineyard/beekeeper.webm') }}" type="video/webm">
                <source data-src="{{ url_for('static', filename='/img/vineyard/beekeeper.mp4') }}" type="video/mp4">
            </video>
            </div>
            <div class="grid-item">
                <video autoplay loop muted playsinline>
                    <source data-src="{{ url_for('static', filename='/img/vineyard/crane.webm') }}" type="video/webm">
                    <source data-src="{{ url_for('static', filename='/img/vineyard/crane.mp4') }}" type="video/mp4">
                </video>
            </div>  

        <div class="grid-item">
            <video autoplay loop muted playsinline>
                <source data-src="{{ url_for('static', filename='/img/vineyard/tractor3_1.webm') }}" type="video/webm">
                <source data-src="{{ url_for('static', filename='/img/vineyard/tractor3_1.mp4') }}" type="video/mp4">
            </video>
        </div>
        <div class="grid-item">
            <img data-src="{{ url_for('static', filename='/img/vineyard/IMG_1423.jpg') }}">
        </div>  
        <div class="grid-item">
            <video autoplay loop muted playsinline>
                <source data-src="{{ url_for('static', filename='/img/vineyard/harvest.webm') }}" type="video/webm">
                <source data-src="{{ url_for('static', filename='/img/vineyard/harvest.mp4') }}" type="video/mp4">
            </video>
        </div> 
        <div class="grid-item">
            <img data-src="{{ url_for('static', filename='/img/vineyard/IMG_8291.jpg') }}">
        </div>      
        <div class="grid-item">
            <img data-src="{{ url_for('static', filename='/img/vineyard/IMG_3443.jpg') }}">
        </div> 
        <div class="grid-item">
            <video autoplay loop muted playsinline>
                <source data-src="{{ url_for('static', filename='/img/vineyard/signpainter.mp4') }}" type="video/mp4">
            </video>
        </div>      
            
        <div class="grid-item">
            <img data-src="{{ url_for('static', filename='/img/vineyard/IMG_6699.jpg') }}">
        </div>      
         <div class="grid-item">
            <img data-src="{{ url_for('static', filename='/img/vineyard/IMG_8177.jpg') }}">
        </div>  
       
         <div class="grid-item">
             <img data-src="{{ url_for('static', filename='/img/vineyard/IMG_8230.jpg') }}">
        </div>

            <div class="grid-item">
                <video autoplay loop muted playsinline>
                 
                    <source data-src="{{ url_for('static', filename='/img/vineyard/tractor8.mp4') }}" type="video/mp4">
                </video>
            </div>  
        <div class="grid-item">
             <img data-src="{{ url_for('static', filename='/img/vineyard/IMG_8258.jpg') }}">
        </div>
        <div class="grid-item">
            <img data-src="{{ url_for('static', filename='/img/vineyard/IMG_1046.jpg') }}">
        </div> 
        <div class="grid-item">
            <video autoplay loop muted playsinline>
                <source data-src="{{ url_for('static', filename='/img/vineyard/harvest.mp4') }}" type="video/mp4">
            </video>
            </div>
       <div class="grid-item">
            <img data-src="{{ url_for('static', filename='/img/vineyard/IMG_8716.jpg') }}">
        </div> 
</div>


    <div>
        {% include 'footervineyard.html' %}
        </div>
        </div>

<script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
<script src="https://unpkg.com/packery@2.1.2/dist/packery.pkgd.min.js"></script>
<script>
window.onload = () => {
    const grid = document.querySelector('.grid');
    if (!grid) return;

    const pckry = new Packery(grid, {
        itemSelector: '.grid-item',
        percentPosition: true
    });

    // Ensure all grid items have a reserved space
    document.querySelectorAll('.grid-item img, .grid-item video').forEach(item => {
        if (item.complete) {
            // Image is already loaded, set aspect ratio
            const aspectRatio = item.naturalWidth / item.naturalHeight;
            item.style.aspectRatio = aspectRatio ? `${aspectRatio} / 1` : "16 / 9";
        } else {
            // Image is not loaded yet, set aspect ratio on load
            item.onload = () => {
                const aspectRatio = item.naturalWidth / item.naturalHeight;
                item.style.aspectRatio = aspectRatio ? `${aspectRatio} / 1` : "16 / 9";
            };
        }
    });

    // Load all images/videos before initializing Packery
    imagesLoaded(grid, function() {
        pckry.layout();
    });
};

document.addEventListener("DOMContentLoaded", function () {
    const lazyImages = document.querySelectorAll('.grid-item img');
    const lazyVideos = document.querySelectorAll('.grid-item video');

    const lazyLoad = (entries, observer) => {
        entries.forEach(entry => {
            const target = entry.target;

            if (entry.isIntersecting) {
                if (target.tagName === 'IMG') {
                    const src = target.dataset.src;  // For images, use data-src
                    if (src) {
                        target.src = src;
                        target.onload = () => {
                            target.classList.add('loaded');  // Optional: add a class for styling once loaded
                            observer.unobserve(target);     // Stop observing once the image is loaded
                        };
                    }
                } else if (target.tagName === 'VIDEO') {
                    const src = target.querySelector('source').dataset.src;  // For videos, use source data-src
                    if (src) {
                        target.querySelector('source').src = src;
                        target.load();  // Reload the video to apply the new source
                        target.oncanplaythrough = () => {
                            target.classList.add('loaded');  // Optional: add a class for styling once loaded
                            observer.unobserve(target);     // Stop observing once the video is loaded
                        };
                    }
                }
            }
        });
    };

    const observer = new IntersectionObserver(lazyLoad, {
        rootMargin: '0px 0px 200px 0px'  // Load images/videos before they are fully in the viewport
    });

    // Observe images
    lazyImages.forEach(img => {
        observer.observe(img);
    });

    // Observe videos
    lazyVideos.forEach(video => {
        observer.observe(video);
    });
});

</script>

</body>
</html>